--- origsrc/filezilla-3.1.3/src/engine/local_filesys.cpp	2008-09-21 08:51:06.000000000 -0500
+++ src/filezilla-3.1.3/src/engine/local_filesys.cpp	2008-09-23 03:17:27.879077800 -0500
@@ -245,7 +245,7 @@
 		return GetFileInfo(tmp, isLink, size, modificationTime, mode);
 	}
 
-	const wxCharBuffer p = path.fn_str();
+	const char *p = path.fn_str();
 	return GetFileInfo(p, isLink, size, modificationTime, mode);
 #endif
 }
@@ -436,14 +436,16 @@
 
 		if (m_dirs_only)
 		{
-			if (entry->d_type == DT_LNK)
+			struct stat buf;
+			stat(entry->d_name, &buf);
+			if (S_ISLNK(buf.st_mode))
 			{
 				bool wasLink;
 				strcpy(m_file_part, entry->d_name);
 				if (GetFileInfo(m_raw_path, wasLink, 0, 0, 0) != dir)
 					continue;
 			}
-			else if (entry->d_type != DT_DIR)
+			else if (!S_ISDIR(buf.st_mode))
 				continue;
 		}
 
@@ -514,7 +516,9 @@
 
 		if (m_dirs_only)
 		{
-			if (entry->d_type == DT_LNK)
+			struct stat buf;
+			stat(entry->d_name, &buf);
+			if (S_ISLNK(buf.st_mode))
 			{
 				strcpy(m_file_part, entry->d_name);
 				enum local_fileType type = GetFileInfo(m_raw_path, isLink, size, modificationTime, mode);
@@ -525,7 +529,7 @@
 				is_dir = type == dir;
 				return true;
 			}
-			else if (entry->d_type != DT_DIR)
+			else if (!S_ISDIR(buf.st_mode))
 				continue;
 		}
 
